#!/usr/bin/env ruby

require 'rubygems'
require "commander/import"
require "lib/cloudsync"

program :version, Cloudsync::VERSION
program :description, "Sync between various backends (S3, Cloudfiles, SFTP)"

command :sync do |c|
  c.syntax = "cloudsync sync --from from_backend --to to_backend [--dry-run]"
  c.description = "Copies all files on from_backend to to_backend."
  c.option "--from from_backend", String, "From Backend"
  c.option "--to to_backend", String, "To Backend"
  c.option "--dry_run", "Dry run?"
  c.action do |args, options|
    options.default :dry_run => false
    
    from_backend = options.from.to_sym
    to_backend   = options.to.to_sym
    
    sync_manager = Cloudsync::SyncManager.new \
                      :from    => from_backend,
                      :to      => to_backend,
                      :dry_run => options.dry_run
    sync_manager.sync!
  end
end
